(function(l,c,n,u,r,I,y,m,p,P){"use strict";const{FormSection:h,FormInput:S}=r.Forms,T=y.findByProps("showUserProfile"),w=y.findByStoreName("UserStore");u.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginLeft:16,marginRight:16,color:p.semanticColors.TEXT_MUTED},textLink:{color:p.semanticColors.TEXT_LINK}});async function N(e){await fetch(`http://${e}/buzzer.ps3mapi?snd=2`),n.logger.log("[PS3] Ring")}function R(e){let{selection:s}=e;const o=I.useProxy(c.storage.selections[s]);return React.createElement(m.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(r.Button,{style:{margin:16},color:"brand",size:r.Button.Sizes.MEDIUM,look:r.Button.Looks.FILLED,onPress:async function(){T.showUserProfile({userId:w.getCurrentUser().id})},text:"Preview your profile"}),React.createElement(h,{title:"Basic",titleStyleType:"no_border"},React.createElement(S,{required:!0,autoFocus:!0,title:"Your console IP",value:o.console_ip,placeholder:"Discord",onChange:function(t){return o.console_ip=t}}),React.createElement(r.Button,{style:{margin:16},color:"brand",size:r.Button.Sizes.MEDIUM,look:r.Button.Looks.FILLED,onPress:async function(){N(o.console_ip)},text:"Ring console"})))}const{FormText:L}=r.Forms,v=c.storage;function A(){async function e(){d.onUnload(),d.onLoad()}return React.createElement(m.TouchableOpacity,{onPress:e},React.createElement(L,{style:{marginRight:12}},"UPDATE"))}function C(){const e=u.NavigationNative.useNavigation();return P.useEffect(function(){e.setOptions({headerRight:A})},[]),React.createElement(R,{selection:v.selected})}var M=function(e){return e[e.PLAYING=0]="PLAYING",e[e.STREAMING=1]="STREAMING",e[e.LISTENING=2]="LISTENING",e[e.WATCHING=3]="WATCHING",e[e.COMPETING=5]="COMPETING",e}(M||{});const a=c.storage;(!a.selected||!a.selections[a.selected])&&(a.selected="default",a.selections={default:B()});function B(){return{console_ip:"192.168.1.7"}}let g=null;async function f(e){u.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:{name:e.name,type:e.type,details:e.details,state:e.state,timestamps:e.timestamps,assets:e.assets,flags:e.flags},pid:1608,socketId:"PS3Activity@Vendetta"})}async function G(e){try{const t=await fetch(`${e}/klic.ps3`);if(!t.ok)throw new Error(`Status ${t.status}`);const i=await t.text();var s=new DOMParser,o=s.parseFromString(i,"text/html");return o}catch(t){return n.logger.log(`[PS3] fetchGameInfo error: ${t}`),null}}async function E(){const{console_ip:e}=a.selections[a.selected],s=`http://${e}`;try{if(!(await fetch(s)).ok)throw new Error("Ping failed");const t=await G(s);if(!t){await f({name:"",type:0,flags:1});return}var o="XMB";const i=t.querySelector("h2").innerText;n.logger.info(i),o=i,await f({name:o,type:0,flags:1}),n.logger.log(t),n.logger.log(`[PS3] Now playing: ${o}`)}catch(t){n.logger.log(`[PS3] updateActivity error: ${t}`)}}var d={onLoad(){n.logger.log("[PS3] Plugin loaded"),E(),g=setInterval(E,15e3)},onUnload(){n.logger.log("[PS3] Plugin unloaded"),g&&clearInterval(g),f({name:"",type:0,flags:1})},settings:C};return l.default=d,Object.defineProperty(l,"__esModule",{value:!0}),l})({},vendetta.plugin,vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.metro,vendetta.metro.common.ReactNative,vendetta.ui,window.React);
