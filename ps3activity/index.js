(function(r,u,n,g,a,G,I,P,E,M){"use strict";const{FormSection:A,FormInput:C}=a.Forms,B=I.findByProps("showUserProfile"),U=I.findByStoreName("UserStore");g.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginLeft:16,marginRight:16,color:E.semanticColors.TEXT_MUTED},textLink:{color:E.semanticColors.TEXT_LINK}});async function k(e){await fetch(`http://${e}/buzzer.ps3mapi?snd=2`),n.logger.log("[PS3] Ring")}function D(e){let{selection:t}=e;const o=G.useProxy(u.storage.selections[t]);return React.createElement(P.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(a.Button,{style:{margin:16},color:"brand",size:a.Button.Sizes.MEDIUM,look:a.Button.Looks.FILLED,onPress:async function(){B.showUserProfile({userId:U.getCurrentUser().id})},text:"Preview your profile"}),React.createElement(A,{title:"Basic",titleStyleType:"no_border"},React.createElement(C,{required:!0,autoFocus:!0,title:"Your console IP",value:o.console_ip,placeholder:"Discord",onChange:function(s){return o.console_ip=s}}),React.createElement(a.Button,{style:{margin:16},color:"brand",size:a.Button.Sizes.MEDIUM,look:a.Button.Looks.FILLED,onPress:async function(){k(o.console_ip)},text:"Ring console"})))}const{FormText:F}=a.Forms,$=u.storage;function b(){async function e(){m.onUnload(),m.onLoad()}return React.createElement(P.TouchableOpacity,{onPress:e},React.createElement(F,{style:{marginRight:12}},"UPDATE"))}function z(){const e=g.NavigationNative.useNavigation();return M.useEffect(function(){e.setOptions({headerRight:b})},[]),React.createElement(D,{selection:$.selected})}var O=function(e){return e[e.PLAYING=0]="PLAYING",e[e.STREAMING=1]="STREAMING",e[e.LISTENING=2]="LISTENING",e[e.WATCHING=3]="WATCHING",e[e.COMPETING=5]="COMPETING",e}(O||{});const i=u.storage;(!i.selected||!i.selections[i.selected])&&(i.selected="default",i.selections={default:x()});function x(){return{console_ip:"192.168.1.7"}}let f=null;async function l(e){g.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:{application_id:"0",name:e.name,type:e.type,details:e.details,state:e.state,timestamps:e.timestamps,assets:e.assets,flags:1},pid:1608,socketId:"PS3Activity@Vendetta"})}async function S(e){try{const t=await fetch(`${e}/klic.ps3`);if(!t.ok)throw new Error(`Status ${t.status}`);return await t.text()}catch(t){return n.logger.log(`[PS3] fetchGameInfo error: ${t}`),null}}function w(e){return e.match(/<h2>(.*?)<\/H2>/)}async function T(e){try{const t=await fetch(`${e}/popup.ps3@info12`);if(!t.ok)throw new Error(`Status ${t.status}`);return(await t.text()).match(/<\/div>Play: (.*?)<div (.*?)>/)[1]}catch(t){return n.logger.error(t),null}}function N(e){let t=e.split(":");var o=parseInt(t[0]);t=t[1].split(".");var s=parseInt(t[0]),d=parseInt(t[1]),y=(o*60+s)*1e3+d;return y}async function R(){const{console_ip:e}=i.selections[i.selected],t=`http://${e}`;try{if(!(await fetch(t)).ok)throw new Error("Ping failed");const c=await T(t);if(!c){await l({name:"",type:0,flags:1});return}const p=await S(t);if(!p){await l({name:"",type:0,flags:1});return}var o=["0","XMB"],s="0";const h=w(p)[0];if(!h){await l({name:"",type:0,flags:1});return}n.logger.info(h),s=c;const v=N(s),L=Math.floor((Date.now()-v)/1e3);n.logger.info(L),n.logger.info(v),o=h.replace(/<h2>/,"").replace(/<\/H2>/,"").split(" ");var[d,...y]=o;const H=y.join(" ");o=[d,H],await l({name:o[1],timestamps:{start:L},type:0,flags:1}),n.logger.log(p),n.logger.log(`[PS3] Now playing: ${o}`)}catch(c){n.logger.log(`[PS3] updateActivity error: ${c}`)}}var m={onLoad(){n.logger.log("[PS3] Plugin loaded"),R(),f=setInterval(R,15e3)},onUnload(){n.logger.log("[PS3] Plugin unloaded"),f&&clearInterval(f),l({name:"",type:0,flags:1})},settings:z};return r.default=m,r.fetchGameInfo=S,r.fetchPlayTime=T,r.getGameName=w,r.toMS=N,Object.defineProperty(r,"__esModule",{value:!0}),r})({},vendetta.plugin,vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.metro,vendetta.metro.common.ReactNative,vendetta.ui,window.React);
