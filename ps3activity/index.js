(function(i,l,a,c,n,E,d,y,m,I){"use strict";const{FormSection:P,FormInput:h}=n.Forms,S=d.findByProps("showUserProfile"),T=d.findByStoreName("UserStore");c.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginLeft:16,marginRight:16,color:m.semanticColors.TEXT_MUTED},textLink:{color:m.semanticColors.TEXT_LINK}});async function w(t){await fetch(`http://${t}/buzzer.ps3mapi?snd=2`),a.logger.log("[PS3] Ring")}function N(t){let{selection:e}=t;const o=E.useProxy(l.storage.selections[e]);return React.createElement(y.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(n.Button,{style:{margin:16},color:"brand",size:n.Button.Sizes.MEDIUM,look:n.Button.Looks.FILLED,onPress:async function(){S.showUserProfile({userId:T.getCurrentUser().id})},text:"Preview your profile"}),React.createElement(P,{title:"Basic",titleStyleType:"no_border"},React.createElement(h,{required:!0,autoFocus:!0,title:"Your console IP",value:o.console_ip,placeholder:"Discord",onChange:function(s){return o.console_ip=s}}),React.createElement(n.Button,{style:{margin:16},color:"brand",size:n.Button.Sizes.MEDIUM,look:n.Button.Looks.FILLED,onPress:async function(){w(o.console_ip)},text:"Ring console"})))}const{FormText:R}=n.Forms,L=l.storage;function v(){async function t(){f.onUnload(),f.onLoad()}return React.createElement(y.TouchableOpacity,{onPress:t},React.createElement(R,{style:{marginRight:12}},"UPDATE"))}function A(){const t=c.NavigationNative.useNavigation();return I.useEffect(function(){t.setOptions({headerRight:v})},[]),React.createElement(N,{selection:L.selected})}var C=function(t){return t[t.PLAYING=0]="PLAYING",t[t.STREAMING=1]="STREAMING",t[t.LISTENING=2]="LISTENING",t[t.WATCHING=3]="WATCHING",t[t.COMPETING=5]="COMPETING",t}(C||{});const r=l.storage;(!r.selected||!r.selections[r.selected])&&(r.selected="default",r.selections={default:$()});function $(){return{console_ip:"192.168.1.7"}}let u=null;async function g(t){c.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:{name:t.name,type:t.type,details:t.details,state:t.state,timestamps:t.timestamps,assets:t.assets,flags:t.flags},pid:1608,socketId:"PS3Activity@Vendetta"})}async function G(t){try{const e=await fetch(`${t}/popup.ps3@info15`);if(!e.ok)throw new Error(`Status ${e.status}`);return(await e.text()).trim()}catch(e){return a.logger.log(`[PS3] fetchGameInfo error: ${e}`),""}}function U(t){const e=t.match(/"(.+)"/);return e?e[1]:t}async function p(){const{console_ip:t}=r.selections[r.selected],e=`http://${t}`;try{if(!(await fetch(e)).ok)throw new Error("Ping failed");const o=await G(e);if(!o){await g({name:"",type:0,flags:1});return}const s=U(o);await g({name:s,type:0,flags:1}),a.logger.log(o),a.logger.log(`[PS3] Now playing: ${s}`)}catch(o){a.logger.log(`[PS3] updateActivity error: ${o}`)}}var f={onLoad(){a.logger.log("[PS3] Plugin loaded"),p(),u=setInterval(p,15e3)},onUnload(){a.logger.log("[PS3] Plugin unloaded"),u&&clearInterval(u),g({name:"",type:0,flags:1})},settings:A};return i.default=f,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.plugin,vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.metro,vendetta.metro.common.ReactNative,vendetta.ui,window.React);
