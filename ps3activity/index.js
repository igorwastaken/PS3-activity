(function(i,c,a,l,r,I,g,m,y,P){"use strict";const{FormSection:h,FormInput:E}=r.Forms,S=g.findByProps("showUserProfile"),T=g.findByStoreName("UserStore");l.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginLeft:16,marginRight:16,color:y.semanticColors.TEXT_MUTED},textLink:{color:y.semanticColors.TEXT_LINK}});function N(t){let{selection:e}=t;const o=I.useProxy(c.storage.selections[e]);return React.createElement(m.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(r.Button,{style:{margin:16},color:"brand",size:r.Button.Sizes.MEDIUM,look:r.Button.Looks.FILLED,onPress:async function(){S.showUserProfile({userId:T.getCurrentUser().id})},text:"Preview your profile"}),React.createElement(h,{title:"Basic",titleStyleType:"no_border"},React.createElement(E,{required:!0,autoFocus:!0,title:"Your console IP",value:o.console_ip,placeholder:"Discord",onChange:function(s){return o.console_ip=s}})))}const{FormText:v}=r.Forms,w=c.storage;function L(){async function t(){f.onUnload(),f.onLoad()}return React.createElement(m.TouchableOpacity,{onPress:t},React.createElement(v,{style:{marginRight:12}},"UPDATE"))}function R(){const t=l.NavigationNative.useNavigation();return P.useEffect(function(){t.setOptions({headerRight:L})},[]),React.createElement(N,{selection:w.selected})}var A=function(t){return t[t.PLAYING=0]="PLAYING",t[t.STREAMING=1]="STREAMING",t[t.LISTENING=2]="LISTENING",t[t.WATCHING=3]="WATCHING",t[t.COMPETING=5]="COMPETING",t}(A||{});const n=c.storage;(!n.selected||!n.selections[n.selected])&&(n.selected="default",n.selections={default:C()});function C(){return{console_ip:"192.168.1.7"}}let u=null;async function d(t){l.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:{name:t.name,type:t.type,details:t.details,state:t.state,timestamps:t.timestamps,assets:t.assets,flags:t.flags},pid:1608,socketId:"PS3Activity@Vendetta"})}async function G(t){try{const e=await fetch(`${t}/popup.ps3@info15`);if(!e.ok)throw new Error(`Status ${e.status}`);return(await e.text()).trim()}catch(e){return a.logger.log(`[PS3] fetchGameInfo error: ${e}`),""}}function $(t){const e=t.match(/"(.+)"/);return e?e[1]:t}async function p(){const{console_ip:t}=n.selections[n.selected],e=`http://${t}`;try{if(!(await fetch(e)).ok)throw new Error("Ping failed");const o=await G(e);if(!o){await d({name:"",type:0,flags:1});return}const s=$(o);await d({name:s,type:0,flags:1}),a.logger.log(`[PS3] Now playing: ${s}`)}catch(o){a.logger.log(`[PS3] updateActivity error: ${o}`)}}var f={onLoad(){a.logger.log("[PS3] Plugin loaded"),p(),u=setInterval(p,15e3)},onUnload(){a.logger.log("[PS3] Plugin unloaded"),u&&clearInterval(u),d({name:"",type:0,flags:1})},settings:R};return i.default=f,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.plugin,vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.metro,vendetta.metro.common.ReactNative,vendetta.ui,window.React);
