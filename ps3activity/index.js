(function(a,f,o,g,r,L,h,y,P,G){"use strict";const{FormSection:v,FormInput:F}=r.Forms,A=h.findByProps("showUserProfile"),C=h.findByStoreName("UserStore");g.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginLeft:16,marginRight:16,color:P.semanticColors.TEXT_MUTED},textLink:{color:P.semanticColors.TEXT_LINK}});async function D(e){await fetch(`http://${e}/buzzer.ps3mapi?snd=2`),o.logger.log("[PS3] Ring")}function b(e){let{selection:t}=e;const n=L.useProxy(f.storage.selections[t]);return React.createElement(y.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(r.Button,{style:{margin:16},color:"brand",size:r.Button.Sizes.MEDIUM,look:r.Button.Looks.FILLED,onPress:async function(){A.showUserProfile({userId:C.getCurrentUser().id})},text:"Preview your profile"}),React.createElement(v,{title:"Basic",titleStyleType:"no_border"},React.createElement(F,{required:!0,autoFocus:!0,title:"Your console IP",value:n.console_ip,placeholder:"Discord",onChange:function(i){return n.console_ip=i}}),React.createElement(r.Button,{style:{margin:16},color:"brand",size:r.Button.Sizes.MEDIUM,look:r.Button.Looks.FILLED,onPress:async function(){D(n.console_ip)},text:"Ring console"})))}const{FormText:k}=r.Forms,M=f.storage;function B(){async function e(){d.onUnload(),d.onLoad()}return React.createElement(y.TouchableOpacity,{onPress:e},React.createElement(k,{style:{marginRight:12}},"UPDATE"))}function U(){const e=g.NavigationNative.useNavigation();return G.useEffect(function(){e.setOptions({headerRight:B})},[]),React.createElement(b,{selection:M.selected})}var $=function(e){return e[e.PLAYING=0]="PLAYING",e[e.STREAMING=1]="STREAMING",e[e.LISTENING=2]="LISTENING",e[e.WATCHING=3]="WATCHING",e[e.COMPETING=5]="COMPETING",e}($||{});const s=f.storage;(!s.selected||!s.selections[s.selected])&&(s.selected="default",s.selections={default:_()});function _(){return{console_ip:"192.168.1.7"}}let m=null;async function l(e){g.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:{application_id:"0",name:e.name,type:e.type,details:e.details,state:e.state,timestamps:e.timestamps,assets:e.assets,flags:1},pid:1608,socketId:"PS3Activity@Vendetta"})}async function w(e){try{const t=await fetch(`${e}/klic.ps3`);if(!t.ok)throw new Error(`Status ${t.status}`);return await t.text()}catch(t){return o.logger.log(`[PS3] fetchGameInfo error: ${t}`),null}}function E(e){return e.match(/<h2>(.*?)<\/H2>/)}async function I(e){try{const t=await fetch(`${e}/popup.ps3@info12`);if(!t.ok)throw new Error(`Status ${t.status}`);return(await t.text()).match(/<\/div>Play: (.*?)<div (.*?)>/)[1]}catch(t){return o.logger.error(t),null}}function x(e){const t=Math.floor(e/60),n=e%60;return new Date().setHours(t,n,0,0)}function S(e){const t=e.split(":").map(Number);if(t.length===3){const[n,i,c]=t;return n*3600+i*60+c}else if(t.length===2){const[n,i]=t;return n*60+i}else return 0}async function T(){const{console_ip:e}=s.selections[s.selected],t=`http://${e}`;try{if(!(await fetch(t)).ok)throw new Error("Ping failed");const u=await I(t);if(!u){await l({name:"",type:0,flags:1});return}const N=await w(t);if(!N){await l({name:"",type:0,flags:1});return}var n=["0","XMB"],i=u;const p=E(N)[0];if(!p){await l({name:"",type:0,flags:1});return}o.logger.info(p);const R=S(i),O=Date.now()-R;o.logger.info(O),o.logger.info(R),n=p.replace(/<h2>/,"").replace(/<\/H2>/,"").split(" ");var[c,...z]=n;const H=z.join(" ");n=[c,H],await l({name:n[1],assets:{large_image:`mp:https://raw.githubusercontent.com/aldostools/Resources/refs/heads/main/COV/${c}.JPG`,large_text:c,small_image:"mp:https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Flogos-world.net%2Fwp-content%2Fuploads%2F2020%2F11%2FPlayStation-Logo1994-2009.png&f=1&ipt=db146efe4c6f8cb8677ae0de6e571d4c665fcebf5ef423130242809d076581c1",small_text:"PlayStation"},type:0,flags:1}),o.logger.log(`[PS3] Now playing: ${n}`)}catch(u){o.logger.log(`[PS3] updateActivity error: ${u}`)}}var d={onLoad(){o.logger.log("[PS3] Plugin loaded"),T(),m=setInterval(T,15e3)},onUnload(){o.logger.log("[PS3] Plugin unloaded"),m&&clearInterval(m),l({name:"",type:0,flags:1})},settings:U};return a.default=d,a.fetchGameInfo=w,a.fetchPlayTime=I,a.getGameName=E,a.parseDuration=S,a.parseTimestamp=x,Object.defineProperty(a,"__esModule",{value:!0}),a})({},vendetta.plugin,vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.metro,vendetta.metro.common.ReactNative,vendetta.ui,window.React);
