(function(o,g,n,f,s,R,y,h,w,G){"use strict";const{FormSection:v,FormInput:M}=s.Forms,B=y.findByProps("showUserProfile"),C=y.findByStoreName("UserStore");f.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginLeft:16,marginRight:16,color:w.semanticColors.TEXT_MUTED},textLink:{color:w.semanticColors.TEXT_LINK}});async function D(e){await fetch(`http://${e}/buzzer.ps3mapi?snd=2`),n.logger.log("[PS3] Ring")}function $(e){let{selection:t}=e;const a=R.useProxy(g.storage.selections[t]);return React.createElement(h.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(s.Button,{style:{margin:16},color:"brand",size:s.Button.Sizes.MEDIUM,look:s.Button.Looks.FILLED,onPress:async function(){B.showUserProfile({userId:C.getCurrentUser().id})},text:"Preview your profile"}),React.createElement(v,{title:"Basic",titleStyleType:"no_border"},React.createElement(M,{required:!0,autoFocus:!0,title:"Your console IP",value:a.console_ip,placeholder:"Discord",onChange:function(i){return a.console_ip=i}}),React.createElement(s.Button,{style:{margin:16},color:"brand",size:s.Button.Sizes.MEDIUM,look:s.Button.Looks.FILLED,onPress:async function(){D(a.console_ip)},text:"Ring console"})))}const{FormText:A}=s.Forms,F=g.storage;function U(){async function e(){p.onUnload(),p.onLoad()}return React.createElement(h.TouchableOpacity,{onPress:e},React.createElement(A,{style:{marginRight:12}},"UPDATE"))}function k(){const e=f.NavigationNative.useNavigation();return G.useEffect(function(){e.setOptions({headerRight:U})},[]),React.createElement($,{selection:F.selected})}var _=function(e){return e[e.PLAYING=0]="PLAYING",e[e.STREAMING=1]="STREAMING",e[e.LISTENING=2]="LISTENING",e[e.WATCHING=3]="WATCHING",e[e.COMPETING=5]="COMPETING",e}(_||{});const r=g.storage;(!r.selected||!r.selections[r.selected])&&(r.selected="default",r.selections={default:b()});function b(){return{console_ip:"192.168.1.7"}}let m=null;async function l(e){var t=f.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:{application_id:"1369465791132729425",name:e.name,type:e.type,details:e.details,state:e.state,timestamps:e.timestamps,assets:e.assets,flags:1},pid:1608,socketId:"PS3Activity@Vendetta"});return n.logger.info(t),t}async function P(e){try{const t=await fetch(`${e}/klic.ps3`);if(!t.ok)throw new Error(`Status ${t.status}`);return await t.text()}catch(t){return n.logger.log(`[PS3] fetchGameInfo error: ${t}`),null}}function S(e){return e.match(/<h2>(.*?)<\/H2>/)}async function T(e){try{const t=await fetch(`${e}/popup.ps3@info12`);if(!t.ok)throw new Error(`Status ${t.status}`);const a=(await t.text()).match(/<\/div>Play: (.*?)<div (.*?)>/);return a[1]?a[1]:void 0}catch(t){return n.logger.error(t),null}}function x(e){const t=Math.floor(e/60),a=e%60;return new Date().setHours(t,a,0,0)}function E(e){const t=e.split(":").map(Number);if(t.length===3){const[a,i,c]=t;return a*3600+i*60+c}else if(t.length===2){const[a,i]=t;return a*60+i}else return 0}async function I(){const{console_ip:e}=r.selections[r.selected],t=`http://${e}`;try{if(!(await fetch(t)).ok)throw new Error("Ping failed");const u=await T(t);if(!u){await l({name:"",type:0,flags:1});return}const N=await P(t);if(!N){await l({name:"PlayStation 3",details:"XMB",assets:{large_image:"https://www.pngplay.com/wp-content/uploads/13/Playstation-Logo-Transparent-File.png",large_text:"PlayStation"},type:0,flags:1});return}var a=["0","XMB"],i=u;const d=S(N)[0];if(!d){await l({name:"PlayStation 3",details:"XMB",assets:{large_image:"https://www.pngplay.com/wp-content/uploads/13/Playstation-Logo-Transparent-File.png",large_text:"PlayStation"},type:0,flags:1});return}n.logger.info(d);const L=E(i),O=Date.now()-L;n.logger.info(O),n.logger.info(L),a=d.replace(/<h2>/,"").replace(/<\/H2>/,"").split(" ");var[c,...z]=a;const H=z.join(" ");a=[c,H],n.logger.info(c),await l({name:"PlayStation 3",details:a[1],assets:{large_image:`https://raw.githubusercontent.com/aldostools/Resources/refs/heads/main/COV/${c}.JPG`,large_text:c,small_image:"https://www.pngplay.com/wp-content/uploads/13/Playstation-Logo-Transparent-File.png",small_text:"PlayStation"},type:0,flags:1}),n.logger.log(`[PS3] Now playing: ${a}`)}catch(u){await l({name:"",details:"",assets:{},flags:1}),n.logger.log(`[PS3] updateActivity error: ${u}`)}}var p={onLoad(){n.logger.log("[PS3] Plugin loaded"),I(),m=setInterval(I,15e3)},onUnload(){n.logger.log("[PS3] Plugin unloaded"),m&&clearInterval(m),l({name:"",flags:1})},settings:k};return o.default=p,o.fetchGameInfo=P,o.fetchPlayTime=T,o.getGameName=S,o.parseDuration=E,o.parseTimestamp=x,Object.defineProperty(o,"__esModule",{value:!0}),o})({},vendetta.plugin,vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.metro,vendetta.metro.common.ReactNative,vendetta.ui,window.React);
