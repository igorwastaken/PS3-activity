(function(i,u,o,g,a,R,h,p,P,L){"use strict";const{FormSection:G,FormInput:v}=a.Forms,A=h.findByProps("showUserProfile"),C=h.findByStoreName("UserStore");g.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginLeft:16,marginRight:16,color:P.semanticColors.TEXT_MUTED},textLink:{color:P.semanticColors.TEXT_LINK}});async function M(e){await fetch(`http://${e}/buzzer.ps3mapi?snd=2`),o.logger.log("[PS3] Ring")}function B(e){let{selection:t}=e;const n=R.useProxy(u.storage.selections[t]);return React.createElement(p.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(a.Button,{style:{margin:16},color:"brand",size:a.Button.Sizes.MEDIUM,look:a.Button.Looks.FILLED,onPress:async function(){A.showUserProfile({userId:C.getCurrentUser().id})},text:"Preview your profile"}),React.createElement(G,{title:"Basic",titleStyleType:"no_border"},React.createElement(v,{required:!0,autoFocus:!0,title:"Your console IP",value:n.console_ip,placeholder:"Discord",onChange:function(l){return n.console_ip=l}}),React.createElement(a.Button,{style:{margin:16},color:"brand",size:a.Button.Sizes.MEDIUM,look:a.Button.Looks.FILLED,onPress:async function(){M(n.console_ip)},text:"Ring console"})))}const{FormText:D}=a.Forms,U=u.storage;function k(){async function e(){m.onUnload(),m.onLoad()}return React.createElement(p.TouchableOpacity,{onPress:e},React.createElement(D,{style:{marginRight:12}},"UPDATE"))}function F(){const e=g.NavigationNative.useNavigation();return L.useEffect(function(){e.setOptions({headerRight:k})},[]),React.createElement(B,{selection:U.selected})}var $=function(e){return e[e.PLAYING=0]="PLAYING",e[e.STREAMING=1]="STREAMING",e[e.LISTENING=2]="LISTENING",e[e.WATCHING=3]="WATCHING",e[e.COMPETING=5]="COMPETING",e}($||{});const r=u.storage;(!r.selected||!r.selections[r.selected])&&(r.selected="default",r.selections={default:b()});function b(){return{console_ip:"192.168.1.7"}}let f=null;async function s(e){g.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:{application_id:"0",name:e.name,type:e.type,details:e.details,state:e.state,timestamps:e.timestamps,assets:e.assets,flags:1},pid:1608,socketId:"PS3Activity@Vendetta"})}async function w(e){try{const t=await fetch(`${e}/klic.ps3`);if(!t.ok)throw new Error(`Status ${t.status}`);return await t.text()}catch(t){return o.logger.log(`[PS3] fetchGameInfo error: ${t}`),null}}function E(e){return e.match(/<h2>(.*?)<\/H2>/)}async function I(e){try{const t=await fetch(`${e}/popup.ps3@info12`);if(!t.ok)throw new Error(`Status ${t.status}`);return(await t.text()).match(/<\/div>Play: (.*?)<div (.*?)>/)[1]}catch(t){return o.logger.error(t),null}}async function S(){const{console_ip:e}=r.selections[r.selected],t=`http://${e}`;try{if(!(await fetch(t)).ok)throw new Error("Ping failed");const c=await I(t);if(!c){await s({name:"",type:0,flags:1});return}const d=await w(t);if(!d){await s({name:"",type:0,flags:1});return}var n=["0","XMB"],l="0";const y=E(d)[0];if(!y){await s({name:"",type:0,flags:1});return}o.logger.info(y),l=c;const T=new Date(l).getTime(),N=Math.floor((Date.now()-T)/1e3);o.logger.info(N),o.logger.info(T),n=y.replace(/<h2>/,"").replace(/<\/H2>/,"").split(" ");var[z,...x]=n;const O=x.join(" ");n=[z,O],await s({name:n[1],timestamps:{start:N},type:0,flags:1}),o.logger.log(d),o.logger.log(`[PS3] Now playing: ${n}`)}catch(c){o.logger.log(`[PS3] updateActivity error: ${c}`)}}var m={onLoad(){o.logger.log("[PS3] Plugin loaded"),S(),f=setInterval(S,15e3)},onUnload(){o.logger.log("[PS3] Plugin unloaded"),f&&clearInterval(f),s({name:"",type:0,flags:1})},settings:F};return i.default=m,i.fetchGameInfo=w,i.fetchPlayTime=I,i.getGameName=E,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.plugin,vendetta,vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.metro,vendetta.metro.common.ReactNative,vendetta.ui,window.React);
